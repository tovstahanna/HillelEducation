import utils from"../utils/render-template.js";import api from"../service/api.js";export default class Cards{constructor(e,t){this._template=e,this._container=t,this._api=new api("https://reqres.in/api/"),this.onEdit=this.onEdit.bind(this),this.onDelete=this.onDelete.bind(this)}fetchCards(e){this._api.fetchUsers(e).then(e=>this.render(e)).catch(e=>console.log(e))}render(e){this._container.innerHTML="",e.data.forEach(e=>{e.image=e.avatar?`<img src="${e.avatar}" alt="${e.last_name}">`:"",this._container.insertAdjacentHTML("beforeend",utils.renderTemplate(this._template,e)),document.getElementById("edit-form-"+e.id).hidden=!0,document.getElementById("edit-"+e.id).addEventListener("click",this.onEdit),document.getElementById("delete-"+e.id).addEventListener("click",this.onDelete)}),1<e.total_pages&&this.pagination(e)}pagination(e){var t=e.page,a=document.createElement("div"),n=(a.id="pagination",document.createElement("a")),i=document.createElement("a"),r=(n.innerText="Previous Page",n.href="#",i.innerText="Next Page",i.href="#",n.setAttribute("data-page",Number(t)-1),i.setAttribute("data-page",Number(t)+1),1==t&&(n.className="disable",n.setAttribute("data-page",Number(t))),t==e.total_pages&&(i.className="disable",i.setAttribute("data-page",Number(t))),a.append(n),a.append(i),a.getElementsByTagName("a"));for(let e=0;e<r.length;e++)r[e].addEventListener("click",e=>{this.fetchCards({page:e.target.getAttribute("data-page")})});this._container.append(a)}addNewCard(e){this._container.insertAdjacentHTML("beforebegin",e),document.getElementById("add-form").addEventListener("submit",t=>{t.preventDefault();let a,n,i,r,d;for(let e=0;e<t.target.length;e++){var s=t.target[e];"first_name"==s.name&&(a=s.value),"last_name"==s.name&&(n=s.value),"email"==s.name&&(i=s.value),"password"==s.name&&(d=s.value),"avatar"==s.name&&(r=s.value)}var e=utils.validation(i,d).join("<br>"),l=document.getElementById("error");e&&(l&&l.remove(),this._container.insertAdjacentHTML("beforebegin",`<p id="error">${e}</p>`)),!e&&i&&d&&(l&&l.remove(),this._api.create({first_name:a,last_name:n,email:i,password:d,avatar:r}).then(e=>{e.image=e.avatar?`<img src="${e.avatar}" alt="${e.last_name}">`:"",this._container.insertAdjacentHTML("afterbegin",utils.renderTemplate(this._template,e)),document.getElementById("edit-form-"+e.id).hidden=!0,document.getElementById("edit-"+e.id).addEventListener("click",this.onEdit),document.getElementById("delete-"+e.id).addEventListener("click",this.onDelete)}).catch(e=>console.log(e)))})}onEdit(e){const i=e.target.id.replace("edit-",""),r=document.getElementById("user-"+i),d=document.getElementById("edit-form-"+i),s=(d.classList.remove("hide"),r.querySelector(".info").hidden=!0,r.querySelector(".buttons").hidden=!0,document.getElementsByClassName("card"));for(let e=0;e<s.length;e++){var t=s[e],a="user-"+i;t.id!=a&&t.classList.add("disable")}d.addEventListener("submit",t=>{t.preventDefault();var a={id:i};for(let e=0;e<t.target.length-1;e++){var n=t.target[e];"first_name"==n.name&&(a.first_name=n.value),"last_name"==n.name&&(a.last_name=n.value),"email"==n.name&&(a.email=n.value),"avatar"==n.name&&(a.avatar=n.value)}console.log(typeof this._api,this._api),this._api.edit(a).then(e=>{console.log(e);var t=e.avatar?`<img src="${e.avatar}" alt="${e.surname}">`:"";r.querySelector(".info").innerHTML=`<h2>${e.first_name} ${e.last_name}</h2>
                                                        ${t}
                                                        <p>${e.email}</p>`,d.classList.add("hide"),r.querySelector(".info").hidden=!1,r.querySelector(".buttons").hidden=!1;for(let e=0;e<s.length;e++){var a=s[e],n="user-"+i;a.id!=n&&a.classList.remove("disable")}}).catch(e=>console.log(e))})}onDelete(e){const t=e.target.id.replace("delete-","");this._api.delete({id:t}).then(e=>{!0===e&&document.getElementById("user-"+t).remove()}).catch(e=>console.log(e))}}