import utils from"../utils/render-template.js";import api from"../service/api.js";import usr from"./user-component.js";export default class Authentication{constructor(e,t){this._template=e,this._container=t,this._api=new api("https://reqres.in/api/"),this._userTemplate=document.getElementById("user-card-template").innerHTML,this._addNewUserTemplate=document.getElementById("add-template").innerHTML,this._usersComponent=new usr(this._userTemplate,this._container,{}),localStorage.getItem("auth_token")&&"QpwL5tke4Pnpja7X4"==localStorage.getItem("auth_token")?this.authorizedAccess():this.render()}render(){this._container.innerHTML=utils.renderTemplate(this._template,{}),document.getElementById("login-form").addEventListener("submit",e=>{e.preventDefault(),this.onSumbit()})}onSumbit(){var e=this._container.querySelector("#email").value,t=this._container.querySelector("#password").value,o=utils.validation(e,t).join("<br>").toUpperCase(),r=document.getElementById("error");o&&(r&&r.remove(),this._container.insertAdjacentHTML("beforebegin",`<p id="error">${o}</p>`)),!o&&e&&t&&(r&&r.remove(),this._api.login({email:e,password:t}).then(e=>{if(400==e.status)return e.json();this.hideLoginForm(),this.authorizedAccess(),e.json().then(e=>{localStorage.setItem("auth_token",JSON.stringify(e).replace('{"token":"',"").replace('"}',""))})}).then(e=>{e&&this._container.insertAdjacentHTML("beforebegin",`<p id="error">${JSON.stringify(e).replace('{"error":"',"").replace('"}',"").toUpperCase()}</p>`)}).catch(e=>console.log(e)))}authorizedAccess(){this._container.insertAdjacentHTML("beforebegin",'<button id="logout">Logout</button>'),this._usersComponent.fetchCards({page:1}),this._usersComponent.addNewCard(this._addNewUserTemplate),document.getElementById("logout").addEventListener("click",e=>{this.onLogout()})}onLogout(){localStorage.removeItem("auth_token"),window.location.reload()}hideLoginForm(){document.getElementById("login-form").hidden=!0}}